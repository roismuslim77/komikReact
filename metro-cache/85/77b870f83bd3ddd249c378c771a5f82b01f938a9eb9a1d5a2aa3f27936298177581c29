{"dependencies":[{"name":"./constants","data":{"isAsync":false}}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  exports.__esModule = true;\n  exports.default = createPersistoid;\n\n  var _constants = _$$_REQUIRE(_dependencyMap[0], \"./constants\");\n\n  function createPersistoid(config) {\n    var blacklist = config.blacklist || null;\n    var whitelist = config.whitelist || null;\n    var transforms = config.transforms || [];\n    var throttle = config.throttle || 0;\n    var storageKey = \"\".concat(config.keyPrefix !== undefined ? config.keyPrefix : _constants.KEY_PREFIX).concat(config.key);\n    var storage = config.storage;\n    var serialize;\n\n    if (config.serialize === false) {\n      serialize = function serialize(x) {\n        return x;\n      };\n    } else if (typeof config.serialize === 'function') {\n      serialize = config.serialize;\n    } else {\n      serialize = defaultSerialize;\n    }\n\n    var writeFailHandler = config.writeFailHandler || null;\n    var lastState = {};\n    var stagedState = {};\n    var keysToProcess = [];\n    var timeIterator = null;\n    var writePromise = null;\n\n    var update = function update(state) {\n      Object.keys(state).forEach(function (key) {\n        if (!passWhitelistBlacklist(key)) return;\n        if (lastState[key] === state[key]) return;\n        if (keysToProcess.indexOf(key) !== -1) return;\n        keysToProcess.push(key);\n      });\n      Object.keys(lastState).forEach(function (key) {\n        if (state[key] === undefined && passWhitelistBlacklist(key) && keysToProcess.indexOf(key) === -1 && lastState[key] !== undefined) {\n          keysToProcess.push(key);\n        }\n      });\n\n      if (timeIterator === null) {\n        timeIterator = setInterval(processNextKey, throttle);\n      }\n\n      lastState = state;\n    };\n\n    function processNextKey() {\n      if (keysToProcess.length === 0) {\n        if (timeIterator) clearInterval(timeIterator);\n        timeIterator = null;\n        return;\n      }\n\n      var key = keysToProcess.shift();\n      var endState = transforms.reduce(function (subState, transformer) {\n        return transformer.in(subState, key, lastState);\n      }, lastState[key]);\n\n      if (endState !== undefined) {\n        try {\n          stagedState[key] = serialize(endState);\n        } catch (err) {\n          console.error('redux-persist/createPersistoid: error serializing state', err);\n        }\n      } else {\n        delete stagedState[key];\n      }\n\n      if (keysToProcess.length === 0) {\n        writeStagedState();\n      }\n    }\n\n    function writeStagedState() {\n      Object.keys(stagedState).forEach(function (key) {\n        if (lastState[key] === undefined) {\n          delete stagedState[key];\n        }\n      });\n      writePromise = storage.setItem(storageKey, serialize(stagedState)).catch(onWriteFail);\n    }\n\n    function passWhitelistBlacklist(key) {\n      if (whitelist && whitelist.indexOf(key) === -1 && key !== '_persist') return false;\n      if (blacklist && blacklist.indexOf(key) !== -1) return false;\n      return true;\n    }\n\n    function onWriteFail(err) {\n      if (writeFailHandler) writeFailHandler(err);\n\n      if (err && process.env.NODE_ENV !== 'production') {\n        console.error('Error storing data', err);\n      }\n    }\n\n    var flush = function flush() {\n      while (keysToProcess.length !== 0) {\n        processNextKey();\n      }\n\n      return writePromise || Promise.resolve();\n    };\n\n    return {\n      update: update,\n      flush: flush\n    };\n  }\n\n  function defaultSerialize(data) {\n    return JSON.stringify(data);\n  }\n});","map":[[2,0,1,0],[4,0,3,0,"exports"],[4,2,3,0,"exports"],[4,9,3,7],[4,10,3,8,"__esModule"],[4,20,3,0],[4,23,3,21],[4,27,3,0],[5,0,4,0,"exports"],[5,2,4,0,"exports"],[5,9,4,7],[5,10,4,8,"default"],[5,17,4,0],[5,20,4,18,"createPersistoid"],[5,36,4,0],[7,0,6,0],[7,6,6,4,"_constants"],[7,16,6,14],[7,19,6,17,"require"],[7,30,6,24],[7,64,6,0],[9,0,9,0],[9,11,9,9,"createPersistoid"],[9,27,9,0],[9,28,9,26,"config"],[9,34,9,0],[9,36,9,34],[10,0,11,2],[10,8,11,6,"blacklist"],[10,17,11,15],[10,20,11,18,"config"],[10,26,11,24],[10,27,11,25,"blacklist"],[10,36,11,18],[10,40,11,38],[10,44,11,2],[11,0,12,2],[11,8,12,6,"whitelist"],[11,17,12,15],[11,20,12,18,"config"],[11,26,12,24],[11,27,12,25,"whitelist"],[11,36,12,18],[11,40,12,38],[11,44,12,2],[12,0,13,2],[12,8,13,6,"transforms"],[12,18,13,16],[12,21,13,19,"config"],[12,27,13,25],[12,28,13,26,"transforms"],[12,38,13,19],[12,42,13,40],[12,44,13,2],[13,0,14,2],[13,8,14,6,"throttle"],[13,16,14,14],[13,19,14,17,"config"],[13,25,14,23],[13,26,14,24,"throttle"],[13,34,14,17],[13,38,14,36],[13,39,14,2],[14,0,15,2],[14,8,15,6,"storageKey"],[14,18,15,16],[14,21,15,19],[14,24,15,22,"concat"],[14,30,15,19],[14,31,15,29,"config"],[14,37,15,35],[14,38,15,36,"keyPrefix"],[14,47,15,29],[14,52,15,50,"undefined"],[14,61,15,29],[14,64,15,62,"config"],[14,70,15,68],[14,71,15,69,"keyPrefix"],[14,80,15,29],[14,83,15,81,"_constants"],[14,93,15,91],[14,94,15,92,"KEY_PREFIX"],[14,104,15,19],[14,106,15,104,"concat"],[14,112,15,19],[14,113,15,111,"config"],[14,119,15,117],[14,120,15,118,"key"],[14,123,15,19],[14,124,15,2],[15,0,16,2],[15,8,16,6,"storage"],[15,15,16,13],[15,18,16,16,"config"],[15,24,16,22],[15,25,16,23,"storage"],[15,32,16,2],[16,0,17,2],[16,8,17,6,"serialize"],[16,17,17,2],[18,0,19,2],[18,8,19,6,"config"],[18,14,19,12],[18,15,19,13,"serialize"],[18,24,19,6],[18,29,19,27],[18,34,19,2],[18,36,19,34],[19,0,20,4,"serialize"],[19,6,20,4,"serialize"],[19,15,20,13],[19,18,20,16],[19,27,20,25,"serialize"],[19,36,20,16],[19,37,20,35,"x"],[19,38,20,16],[19,40,20,38],[20,0,21,6],[20,15,21,13,"x"],[20,16,21,6],[21,0,22,5],[21,7,20,4],[22,0,23,3],[22,5,19,2],[22,11,23,9],[22,15,23,13],[22,22,23,20,"config"],[22,28,23,26],[22,29,23,27,"serialize"],[22,38,23,13],[22,43,23,41],[22,53,23,9],[22,55,23,53],[23,0,24,4,"serialize"],[23,6,24,4,"serialize"],[23,15,24,13],[23,18,24,16,"config"],[23,24,24,22],[23,25,24,23,"serialize"],[23,34,24,4],[24,0,25,3],[24,5,23,9],[24,11,25,9],[25,0,26,4,"serialize"],[25,6,26,4,"serialize"],[25,15,26,13],[25,18,26,16,"defaultSerialize"],[25,34,26,4],[26,0,27,3],[28,0,29,2],[28,8,29,6,"writeFailHandler"],[28,24,29,22],[28,27,29,25,"config"],[28,33,29,31],[28,34,29,32,"writeFailHandler"],[28,50,29,25],[28,54,29,52],[28,58,29,2],[29,0,31,2],[29,8,31,6,"lastState"],[29,17,31,15],[29,20,31,18],[29,22,31,2],[30,0,32,2],[30,8,32,6,"stagedState"],[30,19,32,17],[30,22,32,20],[30,24,32,2],[31,0,33,2],[31,8,33,6,"keysToProcess"],[31,21,33,19],[31,24,33,22],[31,26,33,2],[32,0,34,2],[32,8,34,6,"timeIterator"],[32,20,34,18],[32,23,34,21],[32,27,34,2],[33,0,35,2],[33,8,35,6,"writePromise"],[33,20,35,18],[33,23,35,21],[33,27,35,2],[35,0,37,2],[35,8,37,6,"update"],[35,14,37,12],[35,17,37,15],[35,26,37,24,"update"],[35,32,37,15],[35,33,37,31,"state"],[35,38,37,15],[35,40,37,38],[36,0,39,4,"Object"],[36,6,39,4,"Object"],[36,12,39,10],[36,13,39,11,"keys"],[36,17,39,4],[36,18,39,16,"state"],[36,23,39,4],[36,25,39,23,"forEach"],[36,32,39,4],[36,33,39,31],[36,43,39,41,"key"],[36,46,39,31],[36,48,39,46],[37,0,40,6],[37,12,40,10],[37,13,40,11,"passWhitelistBlacklist"],[37,35,40,33],[37,36,40,34,"key"],[37,39,40,33],[37,40,40,6],[37,42,40,40],[38,0,42,6],[38,12,42,10,"lastState"],[38,21,42,19],[38,22,42,20,"key"],[38,25,42,19],[38,26,42,10],[38,31,42,29,"state"],[38,36,42,34],[38,37,42,35,"key"],[38,40,42,34],[38,41,42,6],[38,43,42,41],[39,0,44,6],[39,12,44,10,"keysToProcess"],[39,25,44,23],[39,26,44,24,"indexOf"],[39,33,44,10],[39,34,44,32,"key"],[39,37,44,10],[39,43,44,41],[39,44,44,42],[39,45,44,6],[39,47,44,45],[40,0,46,6,"keysToProcess"],[40,8,46,6,"keysToProcess"],[40,21,46,19],[40,22,46,20,"push"],[40,26,46,6],[40,27,46,25,"key"],[40,30,46,6],[41,0,47,5],[41,7,39,4],[42,0,50,4,"Object"],[42,6,50,4,"Object"],[42,12,50,10],[42,13,50,11,"keys"],[42,17,50,4],[42,18,50,16,"lastState"],[42,27,50,4],[42,29,50,27,"forEach"],[42,36,50,4],[42,37,50,35],[42,47,50,45,"key"],[42,50,50,35],[42,52,50,50],[43,0,51,6],[43,12,51,10,"state"],[43,17,51,15],[43,18,51,16,"key"],[43,21,51,15],[43,22,51,10],[43,27,51,25,"undefined"],[43,36,51,10],[43,40,51,38,"passWhitelistBlacklist"],[43,62,51,60],[43,63,51,61,"key"],[43,66,51,60],[43,67,51,10],[43,71,51,69,"keysToProcess"],[43,84,51,82],[43,85,51,83,"indexOf"],[43,92,51,69],[43,93,51,91,"key"],[43,96,51,69],[43,102,51,100],[43,103,51,101],[43,104,51,10],[43,108,51,106,"lastState"],[43,117,51,115],[43,118,51,116,"key"],[43,121,51,115],[43,122,51,106],[43,127,51,125,"undefined"],[43,136,51,6],[43,138,51,136],[44,0,52,8,"keysToProcess"],[44,10,52,8,"keysToProcess"],[44,23,52,21],[44,24,52,22,"push"],[44,28,52,8],[44,29,52,27,"key"],[44,32,52,8],[45,0,53,7],[46,0,54,5],[46,7,50,4],[48,0,56,4],[48,10,56,8,"timeIterator"],[48,22,56,20],[48,27,56,25],[48,31,56,4],[48,33,56,31],[49,0,57,6,"timeIterator"],[49,8,57,6,"timeIterator"],[49,20,57,18],[49,23,57,21,"setInterval"],[49,34,57,32],[49,35,57,33,"processNextKey"],[49,49,57,32],[49,51,57,49,"throttle"],[49,59,57,32],[49,60,57,6],[50,0,58,5],[52,0,60,4,"lastState"],[52,6,60,4,"lastState"],[52,15,60,13],[52,18,60,16,"state"],[52,23,60,4],[53,0,61,3],[53,5,37,2],[55,0,63,2],[55,13,63,11,"processNextKey"],[55,27,63,2],[55,30,63,28],[56,0,64,4],[56,10,64,8,"keysToProcess"],[56,23,64,21],[56,24,64,22,"length"],[56,30,64,8],[56,35,64,33],[56,36,64,4],[56,38,64,36],[57,0,65,6],[57,12,65,10,"timeIterator"],[57,24,65,6],[57,26,65,24,"clearInterval"],[57,39,65,37],[57,40,65,38,"timeIterator"],[57,52,65,37],[57,53,65,24],[58,0,66,6,"timeIterator"],[58,8,66,6,"timeIterator"],[58,20,66,18],[58,23,66,21],[58,27,66,6],[59,0,67,6],[60,0,68,5],[62,0,70,4],[62,10,70,8,"key"],[62,13,70,11],[62,16,70,14,"keysToProcess"],[62,29,70,27],[62,30,70,28,"shift"],[62,35,70,14],[62,37,70,4],[63,0,71,4],[63,10,71,8,"endState"],[63,18,71,16],[63,21,71,19,"transforms"],[63,31,71,29],[63,32,71,30,"reduce"],[63,38,71,19],[63,39,71,37],[63,49,71,47,"subState"],[63,57,71,37],[63,59,71,57,"transformer"],[63,70,71,37],[63,72,71,70],[64,0,72,6],[64,15,72,13,"transformer"],[64,26,72,24],[64,27,72,25,"in"],[64,29,72,13],[64,30,72,28,"subState"],[64,38,72,13],[64,40,72,38,"key"],[64,43,72,13],[64,45,72,43,"lastState"],[64,54,72,13],[64,55,72,6],[65,0,73,5],[65,7,71,19],[65,9,73,7,"lastState"],[65,18,73,16],[65,19,73,17,"key"],[65,22,73,16],[65,23,71,19],[65,24,71,4],[67,0,75,4],[67,10,75,8,"endState"],[67,18,75,16],[67,23,75,21,"undefined"],[67,32,75,4],[67,34,75,32],[68,0,76,6],[68,12,76,10],[69,0,77,8,"stagedState"],[69,10,77,8,"stagedState"],[69,21,77,19],[69,22,77,20,"key"],[69,25,77,19],[69,26,77,8],[69,29,77,27,"serialize"],[69,38,77,36],[69,39,77,37,"endState"],[69,47,77,36],[69,48,77,8],[70,0,78,7],[70,9,76,6],[70,10,78,8],[70,17,78,15,"err"],[70,20,78,8],[70,22,78,20],[71,0,79,8,"console"],[71,10,79,8,"console"],[71,17,79,15],[71,18,79,16,"error"],[71,23,79,8],[71,24,79,22],[71,81,79,8],[71,83,79,81,"err"],[71,86,79,8],[72,0,80,7],[73,0,81,5],[73,7,75,4],[73,13,81,11],[74,0,83,6],[74,15,83,13,"stagedState"],[74,26,83,24],[74,27,83,25,"key"],[74,30,83,24],[74,31,83,6],[75,0,84,5],[77,0,86,4],[77,10,86,8,"keysToProcess"],[77,23,86,21],[77,24,86,22,"length"],[77,30,86,8],[77,35,86,33],[77,36,86,4],[77,38,86,36],[78,0,87,6,"writeStagedState"],[78,8,87,6,"writeStagedState"],[78,24,87,22],[79,0,88,5],[80,0,89,3],[82,0,91,2],[82,13,91,11,"writeStagedState"],[82,29,91,2],[82,32,91,30],[83,0,93,4,"Object"],[83,6,93,4,"Object"],[83,12,93,10],[83,13,93,11,"keys"],[83,17,93,4],[83,18,93,16,"stagedState"],[83,29,93,4],[83,31,93,29,"forEach"],[83,38,93,4],[83,39,93,37],[83,49,93,47,"key"],[83,52,93,37],[83,54,93,52],[84,0,94,6],[84,12,94,10,"lastState"],[84,21,94,19],[84,22,94,20,"key"],[84,25,94,19],[84,26,94,10],[84,31,94,29,"undefined"],[84,40,94,6],[84,42,94,40],[85,0,95,8],[85,17,95,15,"stagedState"],[85,28,95,26],[85,29,95,27,"key"],[85,32,95,26],[85,33,95,8],[86,0,96,7],[87,0,97,5],[87,7,93,4],[88,0,98,4,"writePromise"],[88,6,98,4,"writePromise"],[88,18,98,16],[88,21,98,19,"storage"],[88,28,98,26],[88,29,98,27,"setItem"],[88,36,98,19],[88,37,98,35,"storageKey"],[88,47,98,19],[88,49,98,47,"serialize"],[88,58,98,56],[88,59,98,57,"stagedState"],[88,70,98,56],[88,71,98,19],[88,73,98,71,"catch"],[88,78,98,19],[88,79,98,77,"onWriteFail"],[88,90,98,19],[88,91,98,4],[89,0,99,3],[91,0,101,2],[91,13,101,11,"passWhitelistBlacklist"],[91,35,101,2],[91,36,101,34,"key"],[91,39,101,2],[91,41,101,39],[92,0,102,4],[92,10,102,8,"whitelist"],[92,19,102,17],[92,23,102,21,"whitelist"],[92,32,102,30],[92,33,102,31,"indexOf"],[92,40,102,21],[92,41,102,39,"key"],[92,44,102,21],[92,50,102,48],[92,51,102,49],[92,52,102,8],[92,56,102,54,"key"],[92,59,102,57],[92,64,102,62],[92,74,102,4],[92,76,102,74],[92,83,102,81],[92,88,102,74],[93,0,103,4],[93,10,103,8,"blacklist"],[93,19,103,17],[93,23,103,21,"blacklist"],[93,32,103,30],[93,33,103,31,"indexOf"],[93,40,103,21],[93,41,103,39,"key"],[93,44,103,21],[93,50,103,48],[93,51,103,49],[93,52,103,4],[93,54,103,52],[93,61,103,59],[93,66,103,52],[94,0,104,4],[94,13,104,11],[94,17,104,4],[95,0,105,3],[97,0,107,2],[97,13,107,11,"onWriteFail"],[97,24,107,2],[97,25,107,23,"err"],[97,28,107,2],[97,30,107,28],[98,0,109,4],[98,10,109,8,"writeFailHandler"],[98,26,109,4],[98,28,109,26,"writeFailHandler"],[98,44,109,42],[98,45,109,43,"err"],[98,48,109,42],[98,49,109,26],[100,0,111,4],[100,10,111,8,"err"],[100,13,111,11],[100,17,111,15,"process"],[100,24,111,22],[100,25,111,23,"env"],[100,28,111,15],[100,29,111,27,"NODE_ENV"],[100,37,111,15],[100,42,111,40],[100,54,111,4],[100,56,111,54],[101,0,112,6,"console"],[101,8,112,6,"console"],[101,15,112,13],[101,16,112,14,"error"],[101,21,112,6],[101,22,112,20],[101,42,112,6],[101,44,112,42,"err"],[101,47,112,6],[102,0,113,5],[103,0,114,3],[105,0,116,2],[105,8,116,6,"flush"],[105,13,116,11],[105,16,116,14],[105,25,116,23,"flush"],[105,30,116,14],[105,33,116,31],[106,0,117,4],[106,13,117,11,"keysToProcess"],[106,26,117,24],[106,27,117,25,"length"],[106,33,117,11],[106,38,117,36],[106,39,117,4],[106,41,117,39],[107,0,118,6,"processNextKey"],[107,8,118,6,"processNextKey"],[107,22,118,20],[108,0,119,5],[110,0,121,4],[110,13,121,11,"writePromise"],[110,25,121,23],[110,29,121,27,"Promise"],[110,36,121,34],[110,37,121,35,"resolve"],[110,44,121,27],[110,46,121,4],[111,0,122,3],[111,5,116,2],[113,0,125,2],[113,11,125,9],[114,0,126,4,"update"],[114,6,126,4,"update"],[114,12,126,10],[114,14,126,12,"update"],[114,20,125,9],[115,0,127,4,"flush"],[115,6,127,4,"flush"],[115,11,127,9],[115,13,127,11,"flush"],[116,0,125,9],[116,5,125,2],[117,0,129,1],[119,0,132,0],[119,11,132,9,"defaultSerialize"],[119,27,132,0],[119,28,132,26,"data"],[119,32,132,0],[119,34,132,32],[120,0,133,2],[120,11,133,9,"JSON"],[120,15,133,13],[120,16,133,14,"stringify"],[120,25,133,9],[120,26,133,24,"data"],[120,30,133,9],[120,31,133,2],[121,0,134,1]]},"type":"js/module"}]}